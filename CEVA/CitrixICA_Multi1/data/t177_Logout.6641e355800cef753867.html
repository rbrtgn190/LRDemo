(self.webpackChunk_citrite_workspace_ui=self.webpackChunk_citrite_workspace_ui||[]).push([[7913],{19612:function(e,t,r){"use strict";r.r(t),r.d(t,{Logout:function(){return Q}});var n=r(29603),o=r(19394),s=r(41476),a=r(25180),u=r(58640),i=r(55117),c=r(38638),l=r(54559),p=r(73450),f=r(57135),g=r.n(f),d=(r(17782),r(27378)),h=r(9604),m=r(1406),v=r(28035),k=r(20883),y=r(59245),L=r(34388),w=r(92471),x=r.n(w),Z=r(26255),b=r(49193),C=r(2828),S=r(62971),E=r(55817),_=r(24249),I=r(63121),N=r(97478),R=r(32440),q=r(69239),T=h.StyleSheet.create({message:{margin:"20px 0"}}),W=r(97292),P=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o)),(0,p.Z)((0,i.Z)(e),"timer",void 0),(0,p.Z)((0,i.Z)(e),"state",{idpLogoutTimer:0}),(0,p.Z)((0,i.Z)(e),"updateIdpLogoutTime",(function(){try{var t=e.state.idpLogoutTimer-1;t<=0?(e.timer&&clearInterval(e.timer),(0,W.$l)()):e.setState({idpLogoutTimer:t})}catch(t){(0,q.H)(t),clearInterval(e.timer)}})),e}return(0,u.Z)(r,[{key:"render",value:function(){return d.createElement(d.Fragment,null,d.createElement("div",{className:(0,h.css)(T.message)},(0,y.t)("Workspace:logout.idp_logout",{seconds:this.state.idpLogoutTimer})),d.createElement(k.z.Primary,{onClick:W.$l},(0,y.t)("Workspace:logout.complete_logout")))}},{key:"componentDidMount",value:function(){this.startIdpLogoutTimer()}},{key:"componentWillUnmount",value:function(){this.timer&&clearInterval(this.timer)}},{key:"startIdpLogoutTimer",value:function(){this.timer=setInterval(this.updateIdpLogoutTime,1e3),this.setState({idpLogoutTimer:30})}}]),r}(d.Component),D=function(e){(0,c.Z)(w,e);var t,r,n,f=(0,l.Z)(w);function w(){var e;(0,a.Z)(this,w);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e=f.call.apply(f,[this].concat(r)),(0,p.Z)((0,i.Z)(e),"state",{loading:!0,messages:[],allowLogIn:!0,logoutSuccessful:!0,idpLogoutRequired:!1}),(0,p.Z)((0,i.Z)(e),"logIn",(function(){location.assign(location.pathname)})),(0,p.Z)((0,i.Z)(e),"browserLogoff",(function(){(0,W.kS)(e.props.workspaceConfiguration,e.sessionExpired(),e.props.resourceContext,e.passwordChanged(),e.shouldSkipSessionDisconnect()).then((function(t){t.idpLogoutRequired&&!t.idpLogoutTimerRequired?(0,W.$l)():e.setState({loading:!1,messages:t.messages,allowLogIn:t.allowLogIn,logoutSuccessful:t.logoutSuccessful,idpLogoutRequired:t.idpLogoutRequired})})).finally((function(){if(e.props.browserExtensionContext.isSupportedCustomerRuntime){var t=e.sessionExpired(),r=e.passwordChanged();e.props.browserExtensionContext.noteLogout({isSessionExpired:t,isPasswordChanged:r}),t||r||(0,E.c)(!0)}}))})),(0,p.Z)((0,i.Z)(e),"logOffIndependentSessions",(function(){var t=e.props.integrationContext.resolveByCapability(L.fy.logout).map(function(){var e=(0,s.Z)(g().mark((function e(t){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.resolver;case 3:return r=e.sent,e.next=6,r.logout();case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()),r=(0,_.qE)().map((function(e){return e().then((function(){return!0})).catch((function(){return!1}))}));return Promise.all([].concat((0,o.Z)(t),(0,o.Z)(r))).then((function(e){return e.every((function(e){return e}))}))})),e}return(0,u.Z)(w,[{key:"render",value:function(){var e=this.state.messages;return this.state.loading?d.createElement(Z.k,{centerContent:!0},d.createElement("div",{className:(0,h.css)(T.message)},(0,y.t)("Workspace:logout.in_progress")),d.createElement(m.mT,null)):d.createElement(Z.k,{centerContent:!0},d.createElement(d.Fragment,null,this.passwordChanged()&&d.createElement(d.Fragment,null,d.createElement(v.tn,{size:40}),d.createElement("div",{className:(0,h.css)(T.message)},(0,y.t)("Workspace:logout.password_change"))),!!e.length&&d.createElement("div",{className:(0,h.css)(T.message)},e.map((function(e){return d.createElement("div",{key:e},e)}))),this.state.idpLogoutRequired?d.createElement(P,null):d.createElement(d.Fragment,null,!(this.passwordChanged()&&this.state.logoutSuccessful)&&d.createElement("div",{className:(0,h.css)(T.message)},this.sessionExpired()?(0,y.t)("Workspace:logout.session_expired"):this.state.logoutSuccessful?(0,y.t)("Workspace:logout.success"):(0,y.t)("Workspace:logout.error")),this.state.allowLogIn&&d.createElement(k.z.Primary,{onClick:this.logIn},(0,y.t)("Workspace:logout.log_in")))))}},{key:"componentDidMount",value:(n=(0,s.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.idpLogoutError()){e.next=4;break}return this.props.userContext.clear(),this.setStateToError(),e.abrupt("return");case 4:if(!this.isNativeLogoutRequest()){e.next=8;break}return e.next=7,this.handleLogoffRequestFromNative();case 7:return e.abrupt("return");case 8:if(this.passwordChanged()){e.next=16;break}return e.next=11,C.NZ.canLogoff({reason:"userLogoff"});case 11:if("canceled"!==e.sent.result){e.next=16;break}return this.props.history.goBack(),e.abrupt("return");case 16:return this.props.userContext.clear(),e.next=19,this.logOffIndependentSessions();case 19:if(e.sent){e.next=23;break}return this.setStateToError(),e.abrupt("return");case 23:e.t0=C.NZ.nativeLogoffMethod,e.next="attemptLogoff"===e.t0?26:"logOff"===e.t0?28:30;break;case 26:return this.nativeLogoff(),e.abrupt("break",31);case 28:return this.legacyNativeLogoff(),e.abrupt("break",31);case 30:this.browserLogoff();case 31:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleLogoffRequestFromNative",value:(r=(0,s.Z)(g().mark((function e(){var t,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.userContext.clear(),e.next=3,this.logOffIndependentSessions();case 3:(t=e.sent)?this.setState({loading:!1,allowLogIn:!1,logoutSuccessful:!0}):this.setStateToError(),r=this.props.parsedQuery.callbackId,C.NZ.requestLogoff_complete(r,{result:t?"succeeded":"failed"});case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setStateToError",value:function(){this.setState({loading:!1,allowLogIn:!1,messages:[(0,y.t)("Workspace:logout.close_browser")],logoutSuccessful:!1})}},{key:"isNativeLogoutRequest",value:function(){return"true"===this.props.parsedQuery.isNativeLogoutRequest}},{key:"sessionExpired",value:function(){return"inactivity"===this.props.parsedQuery.userHint}},{key:"passwordChanged",value:function(){return"passwordChanged"===this.props.parsedQuery.userHint}},{key:"idpLogoutError",value:function(){return"errorIdpLogout"===this.props.parsedQuery.userHint}},{key:"shouldSkipSessionDisconnect",value:function(){return"true"===this.props.parsedQuery.skipSessionDisconnect}},{key:"nativeLogoff",value:(t=(0,s.Z)(g().mark((function e(){var t,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.NZ.attemptLogoff({reason:this.passwordChanged()?"passwordReset":"userLogoff"});case 2:t=e.sent,r=t.result,e.t0=r,e.next="canceled"===e.t0?7:"succeeded"===e.t0?9:11;break;case 7:return this.props.history.goBack(),e.abrupt("return");case 9:return this.setState({loading:!1,allowLogIn:!1,logoutSuccessful:!0}),e.abrupt("return");case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"legacyNativeLogoff",value:function(){C.NZ.logOff()}}]),w}(d.Component),Q=function(e){var t=(0,b.j)(),r=(0,N.OK)().value,o=(0,S.N)(),s=(0,R.SE)(),a=(0,I.a)(),u=e.location.search,i=d.useMemo((function(){return new(x())(u).query(!0)}),[u]);return d.createElement(D,(0,n.Z)({},e,{workspaceConfiguration:t.workspaceConfiguration,resourceContext:r,integrationContext:o,userContext:s,browserExtensionContext:a,parsedQuery:i}))}},97292:function(e,t,r){"use strict";r.d(t,{kS:function(){return p},v4:function(){return h},$l:function(){return v}});var n,o=r(41476),s=r(57135),a=r.n(s),u=r(54613),i=r(59245),c=r(67921),l=r(98283);function p(e,t,r,n,o){return f.apply(this,arguments)}function f(){return(f=(0,o.Z)(a().mark((function e(t,r,o,s,u){var i,c,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r?n.none:t.userInterface.workspaceControl.logoffAction,d(),e.t0=u,e.t0){e.next=7;break}return e.next=6,h(t,o,i);case 6:e.t0=e.sent;case 7:return c=e.t0,e.next=10,m(t,r);case 10:return l=e.sent,e.abrupt("return",g(c,l,r,s));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,r,n){var o=[],s=!0,a=!0,u=!!(0,l.BJ)()&&!!(0,l.dZ)(),c=!0;u&&r&&((0,l.hV)(!1),(0,l.lV)(!0),u=!1,c=!1);var p=(0,l.Ps)()&&!(0,l.bs)();return e||(o.push((0,i.t)("Workspace:logout.close_apps")),a=!1),p?(o.push((0,i.t)("Workspace:logout.close_browser_to_protect")),s=!1):u?(e&&!n&&(c=!1),s=!1):t?(0,l.BJ)()&&(o.push((0,i.t)("Workspace:logout.log_in_or_close_browser")),s=!0):(o.push((0,i.t)("Workspace:logout.close_browser")),a=!1,s=!1),{messages:o,idpLogoutRequired:u,idpLogoutTimerRequired:c,allowLogIn:s,logoutSuccessful:a}}function d(){c.set("CtxsDesktopAutoLaunchDone","no")}function h(e,t,r){if(r===n.none||!t.resources||!t.resources.length)return Promise.resolve(!0);var o=r===n.terminate||t.isUnauthenticatedStore?e.storeProxy.sessionsProxy.logoffURL:e.storeProxy.sessionsProxy.disconnectURL;return(0,u.v_)(o).then((function(e){return"success"===e.status})).catch((function(){return!1}))}function m(e,t){return(0,l.dZ)()&&!t?Promise.resolve(!0):(0,u.v_)(e.authManager.logoffURL).then((function(){return!0})).catch((function(){return!1}))}function v(){var e=(0,l.dZ)();e&&window.top.location.replace(e)}!function(e){e.disconnect="disconnect",e.terminate="terminate",e.none="none"}(n||(n={}))}}]);
//# sourceMappingURL=Logout.6641e355800cef753867.js.map