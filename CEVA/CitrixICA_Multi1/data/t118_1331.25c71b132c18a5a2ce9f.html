(self.webpackChunk_citrite_workspace_ui=self.webpackChunk_citrite_workspace_ui||[]).push([[1331],{2133:function(e,t,n){"use strict";n.d(t,{l:function(){return d}});var r=n(27378),i=n(9604),a=n(90932),o=n(86985),s={"0%":{backgroundColor:o.red700,width:"10px",height:"10px"},"80%":{backgroundColor:o.red700,width:"10px",height:"10px"},"100%":{backgroundColor:o.red100,width:"24px",height:"24px"}},u={backgroundColor:o.red700,borderRadius:"50%",width:"10px",height:"10px"},c=i.StyleSheet.create({newMessagesIcon:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px"},fadeIn:{animationName:[{"0%":{opacity:0},"100%":{opacity:1}}],animationDuration:"750ms",animationIterationCount:"1"},outerCircle:{backgroundColor:o.red100,borderRadius:"50%",width:"24px",height:"24px"},pulsingCircle:(0,a.Z)((0,a.Z)({},u),{},{animationName:[s],animationDuration:"4s",animationIterationCount:"2"}),staticInnerCircle:(0,a.Z)((0,a.Z)({},u),{},{position:"absolute",top:7,left:7})});function d(e){return r.createElement("div",{className:(0,i.css)(c.newMessagesIcon,e.pulse&&c.fadeIn)},r.createElement("div",{className:(0,i.css)(e.pulse?c.pulsingCircle:c.outerCircle)}),r.createElement("div",{className:(0,i.css)(c.staticInnerCircle)}))}},84126:function(e,t,n){"use strict";n.d(t,{l:function(){return h}});var r=n(64897),i=n(34388),a=n(61320),o=n.n(a),s=n(59245);function u(e,t){var n=e.replace(/'/g,"").trim();return n=function(e){var t=Number.parseInt(e,10);return"false"===e.toLowerCase()||0===e.length||!isNaN(t)&&0===t?"false":"true"}(n),t=t||"yes-no",(0,s.t)("Workspace:boolean."+t+"_"+n)}var c=n(89243);function d(e,t,n){var r=l(n)||(0,c.e)(),i=Number.parseFloat(e);return isNaN(i)?e:f(i.toLocaleString(r,{minimumFractionDigits:t,maximumFractionDigits:t}))}function l(e){switch((null==e?void 0:e.dataFormats.thousandSeparator)+(null==e?void 0:e.dataFormats.decimalSeparator)){case",.":return"en";case".,":return"de";case" ,":return"fr";default:return null}}function f(e){return navigator.userAgent.includes(" AppleWebKit/")&&navigator.userAgent.includes(" Safari/")&&!navigator.userAgent.includes(" Chrome/")?e.replace(/\u202F+/g,"Â "):e}var p={decimal:function(e,t){try{var n=(e.additionalArguments||"2").split(","),i=(0,r.Z)(n,2),a=i[0],o=i[1],u=Number.parseFloat(e.value);if(isNaN(u))throw new Error("invalid decimal value");var p=Number.parseInt(a,10);if(isNaN(p))throw new Error("invalid decimal place value");return o&&"shorten"===o.toLocaleLowerCase().trim()?function(e,t,n){try{var r=(0,c.e)(),i=Number.parseFloat(e),a=i<0,o=Math.abs(i),u=(v=r).startsWith("zh-CN")||v.startsWith("ja")?{minFactor:1,maxFactor:3,baseValue:1e4}:v.startsWith("de")||v.startsWith("it")?{minFactor:2,maxFactor:4,baseValue:1e3}:{minFactor:1,maxFactor:4,baseValue:1e3},p=Math.min(Math.floor(Math.log(o)/Math.log(u.baseValue)),u.maxFactor);if(p<u.minFactor)return d(e,t,n);var h=(a?"-":"")+(o/Math.pow(u.baseValue,p)).toLocaleString(l(n)||r,{minimumFractionDigits:t,maximumFractionDigits:t});return(0,s.t)("Workspace:number_suffix."+{1:"short_number_suffix_1",2:"short_number_suffix_2",3:"short_number_suffix_3",4:"short_number_suffix_4"}[p],{number:f(h)})}catch(t){return e}var v}(e.value,p,t):d(e.value,p,t)}catch(t){return e.defaultValue}},integer:function(e,t){var n=function(e,t){var n=Math.round(Number.parseFloat(e)).toString();return f(Number.parseInt(n,10).toLocaleString(l(t)||(0,c.e)()))}(e.value,t);if(isNaN(Number.parseInt(n,10)))return e.defaultValue;return n},percentage:function(e,t){var n=function(e,t){var n=Math.round(100*Number.parseFloat(e)).toString();return f(Number.parseInt(n,10).toLocaleString(l(t)||(0,c.e)())+"%")}(e.value,t);if(isNaN(Number.parseFloat(n)))return e.defaultValue;return n},date:function(e,t){var n,r=g(e.value.split("'")[1],(null==t||null===(n=t.dataFormats.dateFormat)||void 0===n?void 0:n.toUpperCase())||"L",e.additionalArguments);if(null===r)return e.defaultValue;return r},datetime:function(e,t){var n,r=g(e.value.split("'")[1],((null==t||null===(n=t.dataFormats.dateFormat)||void 0===n?void 0:n.toUpperCase())||"L")+", "+((null==t?void 0:t.dataFormats.timeFormat)||"LT"),e.additionalArguments);if(null===r)return e.defaultValue;return r},time:function(e,t){var n=e.value.split("'")[1];/^[0-9]{2}:[0-9]{2}:[0-9]{2}$/.test(n)&&(n="1970-01-01T"+n+"Z");var r=g(n,(null==t?void 0:t.dataFormats.timeFormat)||"LT",e.additionalArguments);if(null===r)return e.defaultValue;return r},boolean:function(e){var t=e.value,n=e.additionalArguments,r=e.defaultValue;if(!t.startsWith("'"))return r;return u(t,n)}};function h(e){if("string"!=typeof e)return e;var t=i.NT.get().userPreferences,n=/(\{\{format\s)('[^']*'|[^\s]+)(.*)(\}\})/i,a=/(?!\"default:.*?\")\"[^\"]*?\"/gi,o=/\"default:.*?\"/i;return e.replace(/\{\{format\s.*?\}\}/gi,(function(e){var i,s=e.match(n),u=s[2],c=s[3],d=c.match(a),l=c.match(o);if(i=l?(i=l.map(v).toString()).split("default:")[1]:u,!d)return i||u;var f=d.map(v),h=(0,r.Z)(f,2),g=h[0],m=h[1];return p[g]?p[g]({value:u,defaultValue:i,additionalArguments:m||""},t):i||u}))}function v(e){return e.substring(1,e.length-1)}function g(e,t,n){return void 0!==e&&o()(e,o().ISO_8601,!0).isValid()?"no-timezone"===n?o().utc(e).locale((0,c.e)()).format(t):o()(e).locale((0,c.e)()).format(t):null}},51426:function(e,t,n){"use strict";n.d(t,{q:function(){return o}});var r=n(49193),i=n(52041),a=n(32440);function o(){var e=(0,r.j)().workspaceConfiguration,t=(0,a.SE)();return(0,i.Z)(e,t)}},95698:function(e,t,n){"use strict";n.d(t,{HI:function(){return a},ts:function(){return o},dI:function(){return s}});var r=n(99511);function i(e,t,n,i,a,o,s){return{type:r.t.Activity,verb:e,noun:t,detail:{result:n,duration:i,cached:s,httpResponse:a,transactionId:o}}}function a(e,t,n){var r,a,o=!1,s=void 0,u=function(u,c,d,l){if(!o){var f,p=c-a;f=void 0!==s?i(t,n,u,p,d,l,s):i(t,n,u,p,d,l),e(f),o=!0,clearTimeout(r),r=null}};return{startTimer:function(){a=Date.now();r=setTimeout((function(){o||(a=0,u("TIMEOUT",1e4))}),1e4)},setFromCache:function(e){s=e},publishEvent:u}}function o(e,t,n,i){return{type:r.t.Activity,verb:"ACCESS",noun:"PAGE",integration:{iconUrl:e.iconUrl,uuid:e.uuid,title:e.getRawTitle()},card:{timestamp:i,messageUuid:n,cardUuid:t}}}function s(e,t,n,i,a,o,s,u){return{type:r.t.Activity,verb:"RUN",noun:"ACTION",action:{name:e,timestamp:new Date(n).toISOString(),duration:n-t,result:i},integration:{iconUrl:a.iconUrl,uuid:a.uuid,title:a.getRawTitle()},card:{timestamp:u,messageUuid:s,cardUuid:o}}}},18814:function(e,t,n){"use strict";n.d(t,{O:function(){return r},A:function(){return p}});var r,i=n(90932),a=n(70768),o=n(92471),s=n.n(o),u=n(55431),c=n(60379),d=n(52659),l=(0,a.g)((function(){return Promise.all([n.e(7715),n.e(8784),n.e(7032),n.e(8810),n.e(3925),n.e(7347),n.e(273),n.e(2962)]).then(n.bind(n,78940)).then((function(e){return e.GlobalSearchRouteComponent}))}));!function(e){e.ACTIVE="active",e.DISMISSED="dismissed",e.ACTION_REQUIRED="actionRequired"}(r||(r={}));var f=(0,c.j)({component:l,path:"/globalSearch",isAvailable:function(e){return(0,d.ou)(e.workspaceConfiguration,e.userContext)},isLoading:function(e){return!1},getNavLinkProps:void 0,pathParams:{query:!1}}),p=(0,i.Z)((0,i.Z)({},f),{},{getUrl:function(e){var t={query:e.query},n=(0,i.Z)({},e.quickFilter&&{quickFilter:e.quickFilter}),r=new(s())(f.getUrl(t));return r.addSearch(n),r.toString()},getParams:function(e,t){var n,i,a=null!=e&&null!==(n=e.params)&&void 0!==n&&n.query?decodeURIComponent(null==e||null===(i=e.params)||void 0===i?void 0:i.query):null,o=s().parseQuery(t.search),c=(null==o?void 0:o.quickFilter)||null;return Object.values(r).includes(c)||((0,u.H)("Unknown quickFilter in route, '".concat(c,"'")),c=null),{query:a,quickFilter:c}}})},52659:function(e,t,n){"use strict";n.d(t,{ou:function(){return c},jW:function(){return d},Cc:function(){return l}});var r=n(29603),i=n(27378),a=n(34388),o=n(49193),s=n(99982),u=n(32440);function c(e,t){return(0,a.Nc)(e,s.T.GlobalSearch)&&t.isIWSEnabled}function d(){return c((0,o.j)().workspaceConfiguration,(0,u.SE)())}function l(e){return function(t){var n=d();return i.createElement(e,(0,r.Z)({},t,{isGlobalSearchEnabled:n}))}}},55431:function(e,t,n){"use strict";n.d(t,{H:function(){return a}});var r=n(34388),i=n(55832),a=function(){var e;return(e=r.hN.get(i.K).resolve(r.SA.Logger)).logError.apply(e,arguments)}},71436:function(e,t,n){"use strict";n.d(t,{hA:function(){return D},nL:function(){return U},VR:function(){return L},tn:function(){return P},SH:function(){return W}});var r,i=n(41476),a=n(57135),o=n.n(a),s=n(33123),u=n(69239),c=n(24425),d=n(79540),l=n(87732),f=n(90932),p=n(25180),h=n(58640),v=n(55117),g=n(49306),m=n(64420),C=n(38638),F=n(54559),b=n(73450),S=n(22820),w=function(e){(0,C.Z)(r,e);var t,n=(0,F.Z)(r);function r(e,t){var i;return(0,p.Z)(this,r),i=n.call(this,t),(0,b.Z)((0,v.Z)(i),"options",void 0),(0,b.Z)((0,v.Z)(i),"hasResolvedAzureSignalRUrl",void 0),(0,b.Z)((0,v.Z)(i),"connectionId",void 0),i.options=e,i}return(0,h.Z)(r,[{key:"send",value:(t=(0,i.Z)(o().mark((function e(t){var n,i,a,s,u,c,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.options,a=i.baseUrl,s=i.customerId,u=i.storeId,c=i.proxyUrl,this.hasResolvedAzureSignalRUrl){e.next=9;break}return t=(0,f.Z)((0,f.Z)({},t),{},{url:"".concat(a).concat(c),headers:(0,f.Z)((0,f.Z)((0,f.Z)({},t.headers),(0,S.x)()),{},{Accept:"application/json","Citrix-CustomerId":s,"Citrix-InstanceId":u,"Content-Type":"application/json","Citrix-WSP-Proxy-URL":t.url})}),e.next=5,(0,g.Z)((0,m.Z)(r.prototype),"send",this).call(this,t);case 5:200===(n=e.sent).statusCode&&(this.hasResolvedAzureSignalRUrl=!0),e.next=13;break;case 9:return e.next=11,(0,g.Z)((0,m.Z)(r.prototype),"send",this).call(this,t);case 11:n=e.sent,this.connectionId||(this.connectionId=JSON.parse(null===(d=n)||void 0===d?void 0:d.content).connectionId);case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),r}(s.LD),y=n(67023),k=n.n(y),Z=n(2828),E=n(89243);function I(e){for(var t in r)if(null!=e&&e.includes(t))return r[t];switch(e){case"OS X":return r.Mac;case"Ubuntu":case"Debian":case"Fedora":case"Red Hat":return r.Linux;default:return r.Windows}}!function(e){e.Android="Android",e.iOS="iOS",e.Linux="Linux",e.Mac="Mac",e.Windows="Windows"}(r||(r={}));var x,N=function(){var e=(0,i.Z)(o().mark((function e(t){var n,r,i,a,s,u,c,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.connectionId,r=t.registrationUrl,i=t.proxyUrl,a=t.customerId,s=t.storeId,u=t.deviceId,c=Z.NZ.createSSOProxyClient(i),d={application:{applicationIdentifier:"citrix.iws.workspace.web"},browser:{type:k().name,version:k().version},deliveryType:"RealTime",name:"WSUIClient",id:u||null,os:{type:I(k().os.family),version:k().os.version},properties:{language:(0,E.e)()},token:n,type:"Web"},e.abrupt("return",c.postWithFullResponse(r,d,{headers:(0,f.Z)((0,f.Z)({},(0,S.x)()),{},{"Citrix-CustomerId":a,"Citrix-InstanceId":s})}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=[];function L(e){var t;return"Connected"===(null===(t=x)||void 0===t?void 0:t.state)&&e(),T.push(e),function(){return function(e){T=T.filter((function(t){return t!==e}))}(e)}}var _=[];function D(e){return _.push(e),function(){return function(e){_=_.filter((function(t){return t!==e}))}(e)}}var R,A={};function U(e,t){return A[e]?A[e].push(t):A[e]=[t],function(){return function(e,t){A[e]=A[e].filter((function(e){return e!==t}))}(e,t)}}function P(e){return O.apply(this,arguments)}function O(){return(O=(0,i.Z)(o().mark((function e(t){var n,r,i,a,l,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W();case 2:return R=!1,n=(0,c.K)(t,"deviceRegistration"),r=(0,d.v)(n.discoveryUrl),e.next=7,r.getEndpoint("DeviceManagement");case 7:return i=e.sent,e.next=10,r.getEndpoint("SignalRHub");case 10:return e.t0=e.sent,a=e.t0+"/events",l={baseUrl:"".concat(window.location.origin,"/Citrix/StoreWeb/"),proxyUrl:t.authManager.proxyUrl,customerId:t.storeIdentifiers.customerId,storeId:t.storeIdentifiers.storeGuid},f=new w(l,s.W4.instance),(x=(new s.su).configureLogging(s.in.Error).withUrl(a,{httpClient:f}).build()).onclose((function(e){return q(e,t,i)})),e.prev=16,e.next=19,V(t,i);case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(16),(0,u.H)(e.t1,{additionalContext:{event:event}});case 24:case"end":return e.stop()}}),e,null,[[16,21]])})))).apply(this,arguments)}function W(){return M.apply(this,arguments)}function M(){return(M=(0,i.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x){e.next=2;break}return e.abrupt("return");case 2:return clearTimeout(H),R=!0,e.next=6,x.stop();case 6:x=null;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,n){e&&(0,u.H)(e,{additionalContext:{event:event}}),R||j(t,n),_.forEach((function(t){return t(e)}))}var H,B=0;function V(e,t){return Q.apply(this,arguments)}function Q(){return(Q=(0,i.Z)(o().mark((function e(t,n){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.start();case 3:if(!x.connectionId){e.next=8;break}return r=(0,l.fp)("ws-device-id"),i={deviceId:r,connectionId:x.connectionId,registrationUrl:n,proxyUrl:t.authManager.proxyUrl,customerId:t.storeIdentifiers.customerId,storeId:t.storeIdentifiers.storeGuid},e.next=8,N(i).then((function(e){var t;r||(0,l._m)("ws-device-id",null==e||null===(t=e.data)||void 0===t?void 0:t.id)}));case 8:T.forEach((function(e){return e()})),x.on("push",(function(e){try{var t,n=JSON.parse(e);if(null!=n&&n.data)null===(t=A[n.data.serviceId])||void 0===t||t.forEach((function(e){return e(n.data)}))}catch(e){}})),B=0,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),j(t,n);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function j(e,t){B<4&&B++;var n=30*Math.pow(B,3)*1e3;H=window.setTimeout((0,i.Z)(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,V(e,t);case 3:n.next=7;break;case 5:n.prev=5,n.t0=n.catch(0);case 7:case"end":return n.stop()}}),n,null,[[0,5]])}))),n)}},71112:function(e,t,n){"use strict";var r,i,a,o;n.d(t,{m6:function(){return r},uw:function(){return i},Hs:function(){return a},F0:function(){return o}}),function(e){e.createdDate="CREATED_AT",e.relevance="RELEVANCE_DESKTOP"}(r||(r={})),function(e){e.Image="IMAGE"}(i||(i={})),function(e){e.OpenUrl="OPEN_URL",e.PostCallback="POST_CALLBACK"}(a||(a={})),function(e){e[e.Notification=0]="Notification",e[e.Integration=1]="Integration",e[e.RecordId=2]="RecordId"}(o||(o={}))},32593:function(e,t,n){"use strict";n.d(t,{JB:function(){return te},oc:function(){return X},zn:function(){return a}});var r=n(27378),i=r.createContext(null),a=function(){return r.useContext(i)};var o=n(29603),s=n(41476),u=n(25180),c=n(58640),d=n(55117),l=n(38638),f=n(54559),p=n(73450),h=n(19394),v=n(57135),g=n.n(v),m=n(19472),C=n(54613),F=n(59245),b=n(27582),S=n(34388),w=n(41519),y=n(61320),k=n.n(y),Z=n(69635),E=n(69239),I=n(92471),x=n.n(I),N=n(12913),T=n(73517),L=n(64647),_=n(62971),D=n(89243),R=n(57730),A=n(87732),U=n(79924),P=n(71436),O=n(16795),W=n(71112),M=n(64878);var q,H=n(18124),B=n(88531),V=n(51426),Q=n(95698),j=n(99511);!function(e){e.Recency="recency",e.Recommended="recommended"}(q||(q={}));var K=new Map([[W.m6.createdDate,q.Recency],[W.m6.relevance,q.Recommended]]);function G(e){return{type:j.t.NotificationFeed_PageLoad,sortOrder:K.get(e)}}var z=n(35911),J="notification-feed-sort",X=20,Y=n(34735),$=n(30346),ee=function(e){(0,l.Z)(a,e);var t,n=(0,f.Z)(a);function a(e){var t;return(0,u.Z)(this,a),t=n.call(this,e),(0,p.Z)((0,d.Z)(t),"favicon",void 0),(0,p.Z)((0,d.Z)(t),"pushEventServiceConnected",!1),(0,p.Z)((0,d.Z)(t),"feedPolling",void 0),(0,p.Z)((0,d.Z)(t),"skipDataFetch",!1),(0,p.Z)((0,d.Z)(t),"accessFeedEventPublisher",void 0),(0,p.Z)((0,d.Z)(t),"dismissCardEventPublisher",void 0),(0,p.Z)((0,d.Z)(t),"unregisterOnStart",(function(){})),(0,p.Z)((0,d.Z)(t),"unregisterOnClose",(function(){})),(0,p.Z)((0,d.Z)(t),"unregisterOnPush",(function(){})),(0,p.Z)((0,d.Z)(t),"onSignalRStart",(function(){t.pushEventServiceConnected=!0})),(0,p.Z)((0,d.Z)(t),"onSignalRStop",(function(){t.pushEventServiceConnected=!1,t.skipDataFetch=!1})),(0,p.Z)((0,d.Z)(t),"onPushEvent",(function(e){t.skipDataFetch="notifications"!==e.serviceId})),(0,p.Z)((0,d.Z)(t),"mapFeedCardDtoToFeedCard",(function(e){return(0,H.Z)(e,(0,D.e)())})),(0,p.Z)((0,d.Z)(t),"getMappedFeedCards",(function(e){return e.map(t.mapFeedCardDtoToFeedCard)})),(0,p.Z)((0,d.Z)(t),"getFeedCards",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchFromCache:!1},n=e.fetchFromCache;if(t.stopPolling(),t.accessFeedEventPublisher.startTimer(),t.props.notificationService.error)return t.setState({feedLoading:!1,pageLoading:!1,hasError:!0}),Promise.resolve();t.setState({feedLoading:!0,pageLoading:!1,continuationToken:null,polledFeedCards:[],hasNewFeedCards:!1});var r=n?t.tryGetFeedCardsFromCache:t.getFeedCardsFromNetwork;return N.S.mark(N.S.events.EnhancedCache_StartFeedRequest),r({sort:t.state.sort}).then((function(e){N.S.mark(N.S.events.EnhancedCache_FinishFeedRequest),t.setState({feedCards:e,feedLoading:!1,pageLoading:!1,hasError:!1}),t.props.publishEvent(G(t.state.sort)),t.accessFeedEventPublisher.publishEvent("SUCCESS",Date.now()),t.pushEventServiceConnected&&(t.skipDataFetch=!0),t.pollFeed()})).catch((function(e){t.accessFeedEventPublisher.publishEvent("FAILURE",Date.now(),e.status,(0,C.TO)(e)),t.setState({feedCards:[],feedLoading:!1,pageLoading:!1,continuationToken:null,hasError:!0})}))})),(0,p.Z)((0,d.Z)(t),"withNetworkReconciliation",(function(e){var n=t.getFeedCardsFromNetwork({sort:t.state.sort,limit:Math.min(e.length,X)});return setTimeout(function(){var r=(0,s.Z)(g().mark((function r(){var i;return g().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n;case 2:i=r.sent,t.areFeedCardSetsEqual(e,i)||(t.writeFeedCardsToCache(i),t.setState({polledFeedCards:i,newFeedCards:t.filterCards(i,e),hasNewFeedCards:!0}),t.showNotificationFavicon());case 4:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),3e3),e})),(0,p.Z)((0,d.Z)(t),"tryGetFeedCardsFromCache",function(){var e=(0,s.Z)(g().mark((function e(n){var r,i,a=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]&&a[1],e.next=3,t.props.notificationCache.getEncrypted(t.getCacheKey());case 3:return i=e.sent,t.accessFeedEventPublisher.setFromCache((null==i?void 0:i.length)>0),e.abrupt("return",(null==i?void 0:i.length)>0?t.withNetworkReconciliation(i):t.getFeedCardsFromNetwork(n,r));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,p.Z)((0,d.Z)(t),"getFeedCardsFromNetwork",(function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.props.notificationService.value.getFeed(e,n).then((function(e){var n=e.items,r=e.continuationToken;return t.setState({continuationToken:r}),n}))})),(0,p.Z)((0,d.Z)(t),"writeFeedCardsToCache",(function(e){return t.props.notificationCache.setEncrypted(t.getCacheKey(),e)})),(0,p.Z)((0,d.Z)(t),"getNextPage",(function(){t.state.continuationToken&&(t.setState({pageLoading:!0}),t.getFeedCardsFromNetwork({sort:t.state.sort,continuationToken:t.state.continuationToken}).then((function(e){var n=t.uniqueCards([].concat((0,h.Z)(t.state.feedCards),(0,h.Z)(e)));t.setState({feedCards:n,pageLoading:!1}),t.props.publishEvent({type:j.t.NotificationFeed_ScrollLoad})})).catch((function(){t.setState({pageLoading:!1})})))})),(0,p.Z)((0,d.Z)(t),"refreshFeed",(function(){return t.showDefaultFavicon(),t.state.hasNewFeedCards||t.clearHighlightedCards(),t.props.notificationService.error?(t.props.notificationService.reload(),Promise.resolve()):t.getFeedCards()})),(0,p.Z)((0,d.Z)(t),"pollFeed",(function(){var e=t.pushEventServiceConnected?15e3:6e4;t.feedPolling=setTimeout(t.pollFeedLoop,e)})),(0,p.Z)((0,d.Z)(t),"pollFeedLoop",(function(){t.skipDataFetch?t.pollFeed():t.getFeedCardsFromNetwork({sort:t.state.sort,limit:t.state.feedCards.length&&t.state.continuationToken?Math.min(t.state.feedCards.length,X):X},!0).then((function(e){if(t.pushEventServiceConnected&&(t.skipDataFetch=!0),t.state.feedCards.length){var n=t.state.feedCards.slice(0,X),r=t.filterCards(e,n),i=t.filterCards(n,e);(r.length||i.length)&&(t.setState({polledFeedCards:e,newFeedCards:r,hasNewFeedCards:!0}),t.showNotificationFavicon())}else t.setState({feedCards:e})})).then(t.pollFeed).catch((function(){}))})),(0,p.Z)((0,d.Z)(t),"dismissFeedCard",(function(e){t.dismissCardEventPublisher.startTimer();var n=t.removeFeedCard(e);if(n){var r=t.mapFeedCardDtoToFeedCard(n);t.props.notificationService.value.archiveCard(e).then((function(){t.dismissCardEventPublisher.publishEvent("SUCCESS",Date.now()),(0,m.t5)((0,F.t)("Workspace:notification_stream.dismiss_success",{toolName:r.source.integration.getTitle()}),{action:{children:(0,F.t)("Workspace:notification_stream.undo"),onClick:function(){t.props.notificationService.value.unarchiveCard(e).then((function(){t.restoreFeedCard(r)})).catch((function(){t.showErrorToast(r)}))}},timeout:4e3})})).catch((function(e){t.dismissCardEventPublisher.publishEvent("FAILURE",Date.now(),e.status,(0,C.TO)(e)),t.restoreFeedCard(r),t.showErrorToast(r)}))}})),(0,p.Z)((0,d.Z)(t),"bulkDismissFeedCards",function(){var e=(0,s.Z)(g().mark((function e(n,i){var a,o,s,u,c,d;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(0,R.g)(),o=i.source.integration.getTitle(),s=i.source.notification.getLabel(),u="",c="",d=null,e.t0=n,e.next=e.t0===W.F0.Integration?9:e.t0===W.F0.Notification?13:e.t0===W.F0.RecordId?17:21;break;case 9:return u=(0,F.t)("Workspace:notification_stream.dismiss_all_integration_notifications_success",{IntegrationName:r.createElement("strong",null,o)}),c=(0,F.t)("Workspace:notification_stream.dismiss_all_integration_notifications_error",{IntegrationName:r.createElement("strong",null,o)}),d=t.props.notificationService.value.archiveIntegration(i.source.integration.id,a),e.abrupt("break",21);case 13:return u=(0,F.t)("Workspace:notification_stream.dismiss_all_notifications_success",{NotificationName:r.createElement("strong",null,s)}),c=(0,F.t)("Workspace:notification_stream.dismiss_all_notifications_error",{NotificationName:r.createElement("strong",null,s)}),d=t.props.notificationService.value.archiveNotification(i.source.notification.id,a),e.abrupt("break",21);case 17:return u=(0,F.t)("Workspace:notification_stream.dismiss_all_related_notifications_success",{IntegrationName:r.createElement("strong",null,o)}),c=(0,F.t)("Workspace:notification_stream.dismiss_all_related_notifications_error",{IntegrationName:r.createElement("strong",null,o)}),d=t.props.notificationService.value.archiveRecordId(i.recordId,a),e.abrupt("break",21);case 21:if(d){e.next=24;break}return t.showErrorToast(i,c),e.abrupt("return");case 24:return e.next=26,d.then((function(){(0,m.t5)(u,{action:{children:(0,F.t)("Workspace:notification_stream.undo"),onClick:function(){t.setState({feedLoading:!0}),t.props.notificationService.value.unarchiveBulk(a).then((function(){t.refreshFeed()})).catch((function(e){(0,E.H)(e,{tags:{feature:"notification-feed"}}),t.showErrorToast(i,(0,F.t)("Workspace:notification_stream.undo_dismiss_all_error"))})).finally((function(){t.setState({feedLoading:!1})}))}},timeout:4e3}),t.refreshFeed(),(0,w.L)("WsuiCardDismissAllSuccess")})).catch((function(e){(0,E.H)(e,{tags:{feature:"notification-feed"}}),t.showErrorToast(i,c,(function(){return t.bulkDismissFeedCards(n,i)}))}));case 26:return e.abrupt("return",e.sent);case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,p.Z)((0,d.Z)(t),"removeFeedCard",(function(e){var n=t.state.feedCards.find((function(t){return t.id===e}));return n?(t.setState((function(e){return{feedCards:e.feedCards.filter((function(e){return e!==n})),archivedFeedCards:[n].concat((0,h.Z)(e.archivedFeedCards))}})),n):null})),(0,p.Z)((0,d.Z)(t),"restoreFeedCard",(function(e){t.setState((function(t){return{feedCards:[t.archivedFeedCards.find((function(t){return t.id===e.id}))].concat((0,h.Z)(t.feedCards)),archivedFeedCards:t.archivedFeedCards.filter((function(t){return t.id!==e.id}))}}))})),(0,p.Z)((0,d.Z)(t),"showNewCards",(function(){var e;t.showDefaultFavicon(),t.setState((function(e){return{polledFeedCards:[],feedCards:e.polledFeedCards,hasNewFeedCards:!1}})),t.props.publishEvent((e=t.state.sort,{type:j.t.NotificationFeed_LoadNewFeedCards,sortOrder:K.get(e)}))})),(0,p.Z)((0,d.Z)(t),"changeSort",(function(e){var n;(0,A._m)(J,e),t.showDefaultFavicon(),t.setState({sort:e},(function(){return t.getFeedCards()})),t.props.publishEvent((n=e,{newSortOrder:K.get(n),type:j.t.NotificationFeed_SortOrderChange}))})),(0,p.Z)((0,d.Z)(t),"showNotificationFavicon",(function(){t.favicon.href=$})),(0,p.Z)((0,d.Z)(t),"showDefaultFavicon",(function(){t.favicon.href=Y})),(0,p.Z)((0,d.Z)(t),"clearHighlightedCards",(function(){t.setState({newFeedCards:[]})})),t.state={feedCards:[],sort:(0,A.fp)(J)||((0,L.DR)()?W.m6.createdDate:W.m6.relevance),feedLoading:!0,pageLoading:!1,hasNewFeedCards:!1,newFeedCards:[],hasError:!1,polledFeedCards:[],archivedFeedCards:[],errorToasts:[],integrationsLoading:!0},t.favicon=document.querySelector("link[rel*='icon']"),t.favicon||(t.favicon=document.createElement("link"),t.favicon.rel="shortcut icon",t.favicon.type="image/png",t.favicon.href=Y,document.getElementsByTagName("head")[0].appendChild(t.favicon)),t.accessFeedEventPublisher=(0,Q.HI)(t.props.publishEvent,"ACCESS","FEED"),t.dismissCardEventPublisher=(0,Q.HI)(t.props.publishEvent,"DISMISS","CARD"),t}return(0,c.Z)(a,[{key:"render",value:function(){return r.createElement(i.Provider,{value:{feedCards:this.getMappedFeedCards(this.state.feedCards),sort:this.state.sort,feedLoading:this.state.feedLoading||this.state.integrationsLoading,pageLoading:this.state.pageLoading,hasNewFeedCards:this.state.hasNewFeedCards,newFeedCards:this.getMappedFeedCards(this.state.newFeedCards),hasError:this.state.hasError,selectedFeedCardId:this.parseFeedCardIdFromLocation(this.props.location),refreshFeed:this.refreshFeed,getNextPage:this.getNextPage,changeSort:this.changeSort,dismissFeedCard:this.dismissFeedCard,bulkDismissFeedCards:this.bulkDismissFeedCards,removeFeedCard:this.removeFeedCard,restoreFeedCard:this.restoreFeedCard,showNewCards:this.showNewCards,clearHighlightedCards:this.clearHighlightedCards}},this.props.children)}},{key:"componentDidMount",value:function(){this.loadFeedCardIntegrations(),this.props.notificationService.loading||this.startListening()}},{key:"componentDidUpdate",value:function(e,t){if(this.props.notificationService.loading||!e.notificationService.loading){this.areFeedCardSetsEqual(t.feedCards.slice(0,X),this.state.feedCards.slice(0,X))||this.writeFeedCardsToCache(this.state.feedCards.slice(0,X));var n=this.parseFeedCardIdFromLocation(this.props.location),r=this.parseFeedCardIdFromLocation(e.location);n&&(n!==r&&!this.state.feedLoading||t.feedLoading&&!this.state.feedLoading)&&this.openDeepLink(n)}else this.startListening()}},{key:"componentWillUnmount",value:function(){this.unregisterOnStart(),this.unregisterOnClose(),this.unregisterOnPush(),this.stopPolling(),this.favicon.href=Y}},{key:"loadFeedCardIntegrations",value:function(){var e=this,t=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return[].concat((0,h.Z)(t),(0,h.Z)(e.resolveByCapability(n).map((function(e){return e.resolver.catch((function(){return null}))}))))}),[])}(this.props.integrations,S.fy.feedCardExtensions.viewDetails,S.fy.feedCardExtensions.dropdown);t.length||this.setState({integrationsLoading:!1}),Promise.all(t).then((function(){return e.setState({integrationsLoading:!1})}))}},{key:"startListening",value:function(){this.unregisterOnStart=(0,P.VR)(this.onSignalRStart),this.unregisterOnClose=(0,P.hA)(this.onSignalRStop),this.unregisterOnPush=(0,P.nL)(M.r.requiredEndpointServiceName,this.onPushEvent),this.getFeedCards({fetchFromCache:!0}),(0,T.gt)(this.refreshFeed)}},{key:"openDeepLink",value:function(e){this.state.polledFeedCards.length&&this.showNewCards(),this.hasCard(e,this.state.feedCards)||this.hasCard(e,this.state.polledFeedCards)||this.fetchAndShowFeedCard(e)}},{key:"fetchAndShowFeedCard",value:function(e){var t=this;this.props.notificationService.value.getCard(e).then(function(){var e=(0,s.Z)(g().mark((function e(n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return(0,m.cB)((0,F.t)("javascript:generic_error")),e.abrupt("return");case 3:return e.next=5,t.openBlade(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){return(0,m.cB)((0,F.t)("javascript:generic_error"))}))}},{key:"openBlade",value:(t=(0,s.Z)(g().mark((function e(t){var n,r,i,a,o=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={onDismiss:function(){return o.props.history.replace(O.DK)},detail:t.detail,source:t.source,iconUrl:t.iconUrl,title:t.getTitle(),appTitle:t.source.integration.getTitle(),displayTime:k()(t.createdAt).locale((0,D.e)()).from(k()()),cardId:t.id,messageUuid:t.messageUuid,trackDisplayBladeEvent:function(){return o.props.publishEvent((0,Q.ts)(t.source.integration,t.id,t.messageUuid,t.createdAt))}},r=this.getDetailsIntegrationOrDefault(t),i=r.supportedIntegration,r.isDefault){e.next=6;break}return e.next=5,i.resolver.then((function(e){return e.onCardClick(n)}));case 5:return e.abrupt("return");case 6:if(!(a=(0,U.od)().find((function(e){return e.matcher({source:t.source,detail:t.detail})})))){e.next=10;break}return a.handler(n),e.abrupt("return");case 10:return e.next=12,i.resolver.then((function(e){return e.onCardClick(n)}));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getDetailsIntegrationOrDefault",value:function(e){var t,n,r=!1,i=this.props.integrations.resolveByCapability(S.fy.feedCardExtensions.viewDetails).find((function(t){var n,r,i;return(0,B.Q)(t.registration.metadata,null===(n=e.source)||void 0===n?void 0:n.origin,e.detail&&"type"in e.detail?e.detail.type:void 0,null===(r=e.detail)||void 0===r||null===(i=r.rendererParameters)||void 0===i?void 0:i.mfeRenderer)}));i||(r=!0,(0,w.L)("DefaultFeedCardFallbackToMicroapps",{cardDetailType:null===(t=e.detail)||void 0===t?void 0:t.type,cardSourceOrigin:null===(n=e.source)||void 0===n?void 0:n.origin}),i=this.props.integrations.resolveById(b.n.id,"feedCard"));return{supportedIntegration:i,isDefault:r}}},{key:"hasCard",value:function(e,t){return void 0!==t.find((function(t){return t.id===e}))}},{key:"parseFeedCardIdFromLocation",value:function(e){var t=e.search,n=x().parseQuery(t);return null==n?void 0:n.feedCardId}},{key:"uniqueCards",value:function(e){return e.filter((function(e,t,n){return t===n.findIndex((function(t){return t.id===e.id}))}))}},{key:"stopPolling",value:function(){clearTimeout(this.feedPolling)}},{key:"filterCards",value:function(e,t){return e.filter((function(e){return!t.find((function(t){return t.id===e.id}))}))}},{key:"areFeedCardSetsEqual",value:function(e,t){return e.length===t.length&&e.every((function(e,n){return e.id===t[n].id}))}},{key:"showErrorToast",value:function(e,t,n){var r=this;this.removePreviousToast(e),this.setState((function(i){return{errorToasts:[].concat((0,h.Z)(i.errorToasts.filter((function(t){return t.id!==e.id}))),[{id:e.id,handleRemoveNotification:r.generateToastAndReturnHandler(e,t,n)}])}}))}},{key:"removePreviousToast",value:function(e){var t=this.state.errorToasts.find((function(t){return t.id===e.id}));t&&t.handleRemoveNotification()}},{key:"generateToastAndReturnHandler",value:function(e,t,n){return(0,m.cB)(t||(0,F.t)("Workspace:notification_stream.action.error",{toolName:e.source.integration.getTitle()}),n&&{action:{onClick:n,children:(0,F.t)("Workspace:notification_stream.try_again")}})}},{key:"getCacheKey",value:function(){return"notifications-feed-".concat((0,D.e)())}}]),a}(r.Component),te=function(e){var t=(0,V.q)().publishEvent,n=(0,_.N)().resolveById(M.d,"service"),i=(0,z.Yp)().cacheFactory.createEncryptedCacheBucket(z.gT.notifications,{requiresAdminConsentToCache:!0}),a=(0,Z.useLocation)(),s=(0,Z.useHistory)(),u=(0,_.N)();return r.createElement(ee,(0,o.Z)({},e,{publishEvent:t,notificationService:n,notificationCache:i,location:a,history:s,integrations:u}))}},18124:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(90932),i=n(34388),a=n(84126),o=n(71112);function s(e,t){return(0,r.Z)((0,r.Z)({},e),{},{source:d(e.source,t),actions:e.actions.map((function(e){return function(e,t){return{url:e.url,getLabel:function(){return(0,a.l)(e.label[t]||e.label[t.substring(0,2)]||e.label[i.QQ.Default])},getType:function(){switch(e.actionType){case o.Hs.OpenUrl:return"OPEN_URL";case o.Hs.PostCallback:return"POST_CALLBACK";default:return"MAS_CALLBACK"}},postPayload:e.postPayload}}(e,t)})),getTitle:function(){return(0,a.l)(e.title[t]||e.title[t.substring(0,2)]||e.title[i.QQ.Default])},getBody:function(){return(0,a.l)(e.body[t]||e.body[t.substring(0,2)]||e.body[i.QQ.Default])}})}function u(e,t){return{id:e.id,getLabel:function(){return(0,a.l)(e.label[t]||e.label[t.substring(0,2)]||e.label[i.QQ.Default])}}}function c(e,t){return{id:e.id,uuid:e.uuid,iconUrl:e.iconUrl,getTitle:function(){return(0,a.l)(e.title[t]||e.title[t.substring(0,2)]||e.title[i.QQ.Default])},getRawTitle:function(){return e.title}}}function d(e,t){return{origin:e.origin,integration:c(e.integration,t),notification:u(e.notification,t)}}},88531:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});var r=function(e,t,n,r){return"feedCardDetailType"in e&&"MFE"===e.feedCardDetailType&&"MFE"===n?!!r&&e.mfeRenderer===r:"feedCardSourceOrigin"in e?e.feedCardSourceOrigin===t:e.feedCardDetailType===n}},30346:function(e,t,n){"use strict";e.exports=n.p+"a6ae5b6c1a697695f2cb.png"},34735:function(e,t,n){"use strict";e.exports=n.p+"1102480f35b518b91e0a.png"}}]);
//# sourceMappingURL=1331.25c71b132c18a5a2ce9f.js.map